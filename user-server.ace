com.anfelisa.user

target JAVA

ACE {
	GET GetPoints uses Points
	GET GetUserInfo uses UserInfo
	GET GetCourseSelection uses CourseSelection
	GET UsernameAvailable uses UsernameAvailable
	GET GetRole uses Role
	GET GetAllUsers uses UserList

	POST Login uses Login {
		on success (LoginLog.userLoggedIn)
	}
	PUT UpdateUser uses UserUpdate {
		on success ( User.updateUser )
	}
	POST AddCourses uses AddCourses {
		on success (User.addCourses)
	}
	DELETE RemoveCourse uses RemoveCourse {
		on success (User.removeCourse)
	}
	PUT UpdatePassword uses PasswordUpdate {
		on success (User.updatePassword)
	}
	POST ForgotPassword uses ForgotPassword {
		on ok (Email.sendForgotPasswordEmail)
	}
	POST RegisterUser uses UserRegistration {
		on ok (User.registerUser Email.sendRegistrationEmail)
	}
	PUT ConfirmEmail uses Username {
		on ok (User.confirmEmail)
	}
	PUT ChangeUserRole uses ChangeUserRole {
		on ok (User.changeUserRole)
	} 
	DELETE DeleteUser uses DeleteUser {
		on ok (User.deleteUser)
	}
}

views {
	User {
		createUser(UserCreation)
		updateUser(UserUpdate)
		addCourses(AddCourses)
		removeCourse(RemoveCourse)
		updatePassword(PasswordUpdate)
		registerUser(UserRegistration)
		confirmEmail(Username)
		changeUserRole(ChangeUserRole)
		deleteUser(Username)
	}
	LoginLog {
		userLoggedIn(Login)
	}
	external Email {
		sendForgotPasswordEmail(ForgotPassword)
		sendRegistrationEmail(UserRegistration)
	}
}

models {
	schema public
	persistent User {
		Unique PrimaryKey NotNull String username
		NotNull String password
		NotNull String email
		NotNull String role
		NotNull Boolean emailConfirmed
		NotNull Boolean deleted
	}

	persistent LoginLog {
		Unique PrimaryKey NotNull String loginLogId
		NotNull String username references User.username
		NotNull DateTime date
	} 

	Credentials {
		String credentialsUsername
		String credentialsRole
	} 
	
	Role {
		String role
	}

	Points {
		NotNull Integer points
	} 

	Username {
		NotNull String username
	} 
	Available {
		Boolean available
	}
	UsernameAndPassword {
		NotNull String username
		NotNull String password
	} 
	UserRoleUpdate {
		NotNull String editedUsername
		NotNull String role
	}
	UserPasswordUpdate {
		NotNull String editedUsername
		NotNull String newPassword
	}
	DeleteUser {
		NotNull String deletedUsername
	}
	CourseSelection {
		List String courseIdList
	}
	
	CourseId {
		String courseId
	}
	
	ForgotPassword {
		NotNull String username
		NotNull String email
		NotNull String password
	}
	Language {
		NotNull String language
	}
	UserList {
		List User userList
	}
	UserRegistration {
		NotNull String username
		NotNull String password
		NotNull String email
		NotNull String role
	}
}

data {
	UserCreation : ( User )
	Login : ( LoginLog Username )
	Points : ( Points Username )
	UserInfo : (User com.anfelisa.course.CourseList com.anfelisa.box.MyBoxList Username)
	UserUpdate : (UserRoleUpdate Credentials)
	CourseSelection : (com.anfelisa.course.CourseList Credentials)
	AddCourses : (CourseSelection Credentials)
	RemoveCourse : (CourseId Username)
	PasswordUpdate : (Credentials UserPasswordUpdate)
	ForgotPassword : (ForgotPassword Language)
	UsernameAvailable : (Username Available)
	UserRegistration : (UserRegistration Language)
	DeleteUser : ( Credentials DeleteUser)
	Username : (Username)
	ChangeUserRole : (Username Role)
	Role : (Credentials)
	UserList : (UserList)
}

