
com.anfelisa.test

target JAVA

models {
	schema anfelisa
	persistent Test {
		primitiveAttributes {
			Unique PrimaryKey NotNull Serial testId
			NotNull String name
			Integer sequence
			NotNull Integer lessonId references com.anfelisa.lesson.Lesson.lessonId
			NotNull String html
			NotNull String author references com.anfelisa.user.User.username
		}
	}

	LessonId {
		primitiveAttributes {
			NotNull Integer lessonId
		}
	}

	TestId {
		primitiveAttributes {
			NotNull Integer testId
		}
		
	} 

	MyTest {
		primitiveAttributes {
			NotNull Serial testId
			NotNull String name
			Integer sequence
			Integer resultCount
			Boolean hasResults
		}
		complexAttributes {
			List com.anfelisa.result.ResultAbstract resultAbstractList
		}
		
	} 
	
	TestList {
		complexAttributes {
			List Test testList
		}
	}
	
	MyTestList {
		complexAttributes {
			List MyTest myTestList
		} 
	}
	
	CardContentHashList {
		primitiveAttributes {
			List Integer contentHashList
		}
	}
}

data {
	TestCreation : ( Test )
	TestList : (TestList LessonId com.anfelisa.lesson.LessonAbstract com.anfelisa.course.CourseAbstract)
	Test : ( Test LessonId com.anfelisa.lesson.LessonAbstract com.anfelisa.course.CourseAbstract TestList) 
	MyTestList : (MyTestList LessonId com.anfelisa.user.Username com.anfelisa.lesson.LessonAbstract com.anfelisa.course.CourseAbstract)
	MyTest : ( Test LessonId com.anfelisa.user.Username com.anfelisa.lesson.LessonAbstract com.anfelisa.course.CourseAbstract MyTestList) 
	CardContentHashList : (CardContentHashList TestId)
}

actions {
	POST CreateTest uses TestCreation executes CreateTest
	GET LoadPublicTests uses TestList
	GET LoadPublicTest uses Test
	GET LoadPrivateTests uses MyTestList
	GET LoadPrivateTest uses MyTest
	GET GetTest uses TestCreation
	PUT UpdateTest uses TestCreation executes UpdateTest
	GET GetCardsOfTest uses CardContentHashList
}

commands {
	CreateTest uses TestCreation {
		on created publishes ( TestCreated )
	}
	UpdateTest uses TestCreation {
		on updated publishes (TestUpdated)
	}
}

events {
	TestCreated uses TestCreation listenedToBy ( Test.createTest )
	TestUpdated uses TestCreation listenedToBy (Test.updateTest)
}

views {
	Test {
		createTest (TestCreation)
		updateTest (TestCreation)
	}
}
